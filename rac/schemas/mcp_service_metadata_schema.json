{
  "$schema": "https://json-schema.org/draft-07/schema",
  "title": "SOHOAAS MCP Service Response Schema",
  "description": "Validation schema for complete MCP service response - based on actual MCP server structure from localhost:8080/api/services",
  "type": "object",
  "required": ["providers"],
  "properties": {
    "providers": {
      "type": "object",
      "required": ["workspace"],
      "properties": {
        "workspace": {
          "type": "object",
          "description": "Workspace provider containing all Google Workspace services",
          "properties": {
            "calendar": {
              "$ref": "#/definitions/ServiceDefinition"
            },
            "docs": {
              "$ref": "#/definitions/ServiceDefinition"
            },
            "drive": {
              "$ref": "#/definitions/ServiceDefinition"
            },
            "gmail": {
              "$ref": "#/definitions/ServiceDefinition"
            }
          },
          "additionalProperties": {
            "$ref": "#/definitions/ServiceDefinition"
          }
        }
      },
      "additionalProperties": {
        "type": "object",
        "description": "Additional providers (e.g., office365, slack)",
        "additionalProperties": {
          "$ref": "#/definitions/ServiceDefinition"
        }
      }
    }
  },
  "additionalProperties": false,

  "definitions": {
    "ServiceDefinition": {
      "type": "object",
      "description": "Google Workspace service definition - matches actual MCP server response structure",
      "required": ["description", "display_name", "functions"],
      "properties": {
        "description": {
          "type": "string",
          "description": "Service description"
        },
        "display_name": {
          "type": "string",
          "description": "Human-readable service name"
        },
        "functions": {
          "type": "object",
          "description": "Available functions for this service",
          "patternProperties": {
            "^[a-z][a-z0-9_]*$": {
              "$ref": "#/definitions/FunctionDefinition"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "FunctionDefinition": {
      "type": "object",
      "description": "Function definition - matches actual MCP server response structure with response schemas",
      "required": ["name", "display_name", "description", "example_payload", "required_fields"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Function name (matches key in functions object)"
        },
        "display_name": {
          "type": "string",
          "description": "Human-readable function name"
        },
        "description": {
          "type": "string",
          "description": "Function description"
        },
        "example_payload": {
          "type": "object",
          "description": "Example parameters for this function",
          "additionalProperties": true
        },
        "required_fields": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of required parameter names"
        },
        "output_schema": {
          "$ref": "#/definitions/ResponseSchema",
          "description": "Schema describing successful function response structure"
        },
        "error_schema": {
          "$ref": "#/definitions/ResponseSchema",
          "description": "Schema describing error response structure"
        }
      },
      "additionalProperties": false
    },

    "ResponseSchema": {
      "type": "object",
      "description": "JSON Schema definition for function response (success or error)",
      "required": ["type", "description", "properties"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["object"],
          "description": "Schema type (always 'object' for MCP responses)"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the response"
        },
        "properties": {
          "type": "object",
          "description": "Response property definitions",
          "patternProperties": {
            "^[a-zA-Z][a-zA-Z0-9_]*$": {
              "$ref": "#/definitions/PropertySchema"
            }
          },
          "additionalProperties": false
        },
        "required": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of required response properties"
        }
      },
      "additionalProperties": false
    },

    "PropertySchema": {
      "type": "object",
      "description": "Individual property schema definition",
      "required": ["type", "description"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["string", "number", "boolean", "array", "object"],
          "description": "Property data type"
        },
        "description": {
          "type": "string",
          "description": "Property description"
        }
      },
      "additionalProperties": false
    }
  },

  "examples": [
    {
      "providers": {
        "workspace": {
          "gmail": {
            "description": "Send, receive, and manage emails using Gmail API",
            "display_name": "Gmail",
            "functions": {
              "send_message": {
                "name": "send_message",
                "display_name": "Send Email",
                "description": "Send an email message via Gmail",
                "example_payload": {
                  "body": "This is a test email from SOHOaaS",
                  "subject": "Test Email",
                  "to": "recipient@example.com"
                },
                "required_fields": [
                  "to",
                  "subject",
                  "body"
                ],
                "output_schema": {
                  "type": "object",
                  "description": "Gmail send message response",
                  "properties": {
                    "message_id": {
                      "type": "string",
                      "description": "Gmail message ID"
                    },
                    "thread_id": {
                      "type": "string",
                      "description": "Gmail thread ID"
                    },
                    "status": {
                      "type": "string",
                      "description": "Send status"
                    },
                    "sent_at": {
                      "type": "string",
                      "description": "ISO timestamp when sent"
                    }
                  },
                  "required": ["message_id", "thread_id", "status", "sent_at"]
                },
                "error_schema": {
                  "type": "object",
                  "description": "Gmail send message error response",
                  "properties": {
                    "error_code": {
                      "type": "string",
                      "description": "Error code"
                    },
                    "error_message": {
                      "type": "string",
                      "description": "Error message"
                    }
                  },
                  "required": ["error_code", "error_message"]
                }
              }
            }
          },
          "docs": {
            "description": "Create, edit, and manage documents using Google Docs API",
            "display_name": "Google Docs",
            "functions": {
              "create_document": {
                "name": "create_document",
                "display_name": "Create Document",
                "description": "Create a new Google Docs document",
                "example_payload": {
                  "title": "Test Document"
                },
                "required_fields": [
                  "title"
                ]
              }
            }
          }
        }
      }
    }
  ]
}
