graph TB
    %% User Interface Layer
    subgraph "User Interface"
        UI1[OAuth Login Button]
        UI2[Personal Capability Showcase]
        UI3[Direct Intent Chat]
        UI4[Workflow Approval & Execution]
    end
    
    %% 4-Agent PoC Pipeline (LLM-Powered)
    subgraph "Autonomous Agents"
        A1[Intent Gatherer<br/>Multi-turn workflow discovery]
        A2[Intent Analyst<br/>Workflow pattern analysis]
        A3[Workflow Generator<br/>JSON workflow generation]
        A4[Workflow Validator<br/>CUE workflow validation]
    end
    
    %% 4-Service PoC Pipeline (Deterministic)
    subgraph "Deterministic Services"
        S1[Personal Capabilities Service<br/>MCP discovery + parameter schemas]
        S2[CUE Generator Service<br/>JSONâ†’CUE conversion]
        S3[Workflow Executor Service<br/>Step-by-step MCP execution]
        S4[Agent Manager Service<br/>Event orchestration]
    end
    
    %% MCP Integration Layer
    subgraph "MCP Integration"
        MCP1[Gmail MCP Server<br/>Email operations]
        MCP2[Google Docs MCP Server<br/>Document operations]
        MCP3[Google Calendar MCP Server<br/>Calendar operations]
        MCP4[Google Drive MCP Server<br/>File operations]
    end
    
    %% External Services
    subgraph "External Services"
        EXT1[Google OAuth2<br/>Authentication]
        EXT2[OpenAI GPT-4<br/>LLM Provider]
        EXT3[Firebase Firestore<br/>Storage]
        EXT4[Cloud Run<br/>Deployment]
    end
    
    %% PoC Pipeline Flow (Event-Driven)
    UI1 -->|OAuth Login| S1
    S1 -->|user_authenticated| S1
    S1 -->|capabilities_discovered| A1
    
    UI3 -->|User Intent| A1
    A1 -->|workflow_intent_discovered| A2
    A2 -->|intent_analysis_complete| A3
    A3 -->|workflow_generation_complete| S2
    S2 -->|cue_conversion_complete| A4
    A4 -->|validation_complete| S3
    S3 -->|execution_completed| UI4
    
    %% Agent Manager Orchestration
    S4 -.->|Event Routing| A1
    S4 -.->|Event Routing| A2
    S4 -.->|Event Routing| A3
    S4 -.->|Event Routing| A4
    S4 -.->|Event Routing| S1
    S4 -.->|Event Routing| S2
    S4 -.->|Event Routing| S3
    
    %% MCP Integration
    S1 -->|Parameter Schemas| MCP1
    S1 -->|Parameter Schemas| MCP2
    S1 -->|Parameter Schemas| MCP3
    S1 -->|Parameter Schemas| MCP4
    
    S3 -->|Workflow Execution| MCP1
    S3 -->|Workflow Execution| MCP2
    S3 -->|Workflow Execution| MCP3
    S3 -->|Workflow Execution| MCP4
    
    %% External Service Integration
    S1 -.->|OAuth2| EXT1
    A2 -.->|LLM Calls| EXT2
    A3 -.->|LLM Calls| EXT2
    A4 -.->|LLM Calls| EXT2
    S4 -.->|State Storage| EXT3
    S4 -.->|Deployment| EXT4
    
    %% MCP to Google APIs
    MCP1 -.->|Gmail API| EXT1
    MCP2 -.->|Docs API| EXT1
    MCP3 -.->|Calendar API| EXT1
    MCP4 -.->|Drive API| EXT1
    
    %% Styling
    classDef agentClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef serviceClass fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef mcpClass fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef extClass fill:#fff3e0,stroke:#e65100,stroke-width:2px
    
    class A1,A2,A3,A4 agentClass
    class S1,S2,S3,S4 serviceClass
    class MCP1,MCP2,MCP3,MCP4 mcpClass
    class EXT1,EXT2,EXT3,EXT4 extClass
    
    %% Styling
    classDef uiLayer fill:#e3f2fd,stroke:#333,stroke-width:2px,color:#000
    classDef stateLayer fill:#f1f8e9,stroke:#333,stroke-width:2px,color:#000
    classDef llmLayer fill:#fce4ec,stroke:#333,stroke-width:2px,color:#000
    classDef mcpLayer fill:#fff3e0,stroke:#333,stroke-width:2px,color:#000
    classDef racLayer fill:#f3e5f5,stroke:#333,stroke-width:2px,color:#000
    classDef extLayer fill:#eceff1,stroke:#333,stroke-width:2px,color:#000
    
    class UI1,UI2,UI3,UI4,UI5,UI6 uiLayer
    class S1,S2,S3,S4,S5,S6,S7,S8 stateLayer
    class LLM1,LLM2,LLM3,LLM4 llmLayer
    class MCP1,MCP2,MCP3,MCP4 mcpLayer
    class RAC1,RAC2,RAC3,RAC4 racLayer
    class EXT1,EXT2,EXT3,EXT4 extLayer
