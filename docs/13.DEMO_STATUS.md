# SOHOaaS Demo Status (Current)

## Working
- __MCP REST + WS endpoints__
  - REST: `/api/mcp/tools`, `/api/mcp/tools/call`, `/api/mcp/resources`, `/api/mcp/resources/read` in `mcp/server/backend/main.go`
  - WS: `/mcp` handled by `MCPServer.HandleWebSocket()` in `mcp/server/backend/mcp/server.go`
- __Workspace service proxies__
  - Gmail: `gmail.send_message` with required fields enforced (`getAvailableTools()` in `mcp/server/backend/mcp/server.go`)
  - Docs: `docs.create_document`
  - Drive: `drive.share_file`
  - Calendar: `calendar.create_event`, `calendar.get_event`, `calendar.list_events`, `calendar.update_event`, `calendar.delete_event` in `mcp/server/backend/providers/workspace/calendar_proxy.go`
- __Token handling for MCP tools__
  - Expects Google OAuth token in JSON as `arguments.token` â†’ injected into workflow engine as `oauth_token` and provider token
  - Ref: `executeTool()` and `executeToolViaWorkflow()` in `mcp/server/backend/mcp/server.go`
- __Tool schemas + scopes__
  - `GET /api/mcp/tools` synthesizes input schemas and minimal scopes map in `mcp/server/backend/main.go`
- __Workflow engine integration__
  - MCP tools execute through unified workflow engine `workflow.MultiProviderWorkflowEngine` with a single-step workflow

## Partially working / Notes
- __Frontend auth vs Google OAuth token__
  - Frontend uses its own app auth (e.g., Firebase). MCP tool calls still require a Google access token in the body (not headers).
  - Ensure correct scopes per tool (e.g., `calendar.events` for create/update, `calendar.readonly` for list).
- __Docs/Drive advanced flows__
  - Basic operations are implemented. Complex scenarios (templating variations, permission edge cases) may need additional testing.
- __Tool discovery parity__
  - `GET /api/mcp/tools` is generated from proxy metadata; keep proxy metadata authoritative to avoid drift.

## Not working / Backlog (to validate)
- __End-to-end frontend flow passing Google token automatically__
  - Currently, examples assume manual token supply for MCP testing. A seamless handoff from frontend OAuth to MCP arguments is a potential enhancement.
- __Granular OAuth scopes per-function__
  - A minimal map exists; expand/validate scopes per function as coverage grows (see `scopesMap` in `main.go`).
- __Error surfaces + observability__
  - Add more structured errors/logging around Calendar/Gmail edge cases and return them consistently through MCP responses.

## How to verify quickly
- __Calendar list events__
  - Use OAuth Playground token and call `POST /api/mcp/tools/call` with `name: "calendar.list_events"` and `arguments.token` + `time_min/time_max`.
- __Calendar create event__
  - Call `calendar.create_event`; expect `event_id` in response (`createEvent()` returns `event_id`).
- __Gmail send message__
  - Call `gmail.send_message` with `to/subject/body`; verify success message/id.

## References
- MCP server: `mcp/server/backend/mcp/server.go`
- HTTP routing: `mcp/server/backend/main.go`
- Calendar proxy: `mcp/server/backend/providers/workspace/calendar_proxy.go`
